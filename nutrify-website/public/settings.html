<html>
    <head>
      <title>Formulas</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width">
      <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>
      <script src='https://www.gstatic.com/firebasejs/7.15.5/firebase.js'></script>
      <script src="script.js"></script>
    </head>
    <body>
        <script>
            var calc;
            var test = db.collection("temporaryCollection").doc("temporaryDocument");
            window.onload = nutritionalSync("10July2020"); //can be changed later
            var RegularDiet = ["150=350", "2.2=7.7"];
            function nutritionalSync(enp) {
                //defining the variables//
                var age = "13";
                var weight = "100";
                var gender = "M"; //F for female
                //defining the variables//

                test.get().then(function(doc) {
                    eval("var nutrients = doc.data().dailyData['" + enp + "'].nutrients;"); 
                    for(let i=0; i<1; i++) { //change i<36 later
                        var force = RegularDiet[i];
                        var classArray = [];
                        var comp ="";
                        for(let l=0; l<force.length; l++) {
                            if(force[l] == "ðŸ˜ƒ" || l+1 == force.length) {
                                if(l+1 == force.length) {
                                    comp += force[l];
                                }
                                classArray.push(comp);
                                comp = "";
                            } else {
                                comp += force[l];
                            }
                        }
                        var finalAge = "", finalWeight="", finalGender="", finalValue="", prop="", countUp=0;
                        for(let m=0; m<classArray.length; m++) {
                            if(classArray[m] == ";" || m+1 == classArray.length) {
                                if(m+1 == classArray.length) {
                                    prop += classArray[m];
                                }
                                if(prop == "M" || prop == "F") {
                                    finalGender = prop; 
                                } else if(prop.includes("-") == true) {
                                    finalAge = prop;
                                } else if(prop.includes("~") == true) {
									finalWeight = prop;
								} else if(prop.includes("=") == true) {
									finalValue = prop;
								}
								prop = "";
                            } else {
                                prop += classArray[m];
                            }
                        }
						if(finalAge != "") {
							countUp++;
						}
						if(finalGender != "") {
							countUp++;
						}
						if(finalWeight != "") {
							countUp++;
						}
                        var yay = true;
						while(yay == true) {
							if(countUp == 0) {
                                predetermined(finalAge, finalGender, finalWeight, finalValue, age, gender, weight, nutrients[i]);
                                yay=false;
                                if(calc == 1) {
                                    alert("We are all good!");
                                    yay = false;
                                }
							} else if(countUp == 1) {
                                predetermined(finalAge, finalGender, finalWeight, finalValue, age, gender, weight, nutrients[i]);
                                if(calc == 2) {
                                    alert("We are all good!");
                                    yay = false;
                                }

							} else if(countUp == 2) {
                                predetermined(finalAge, finalGender, finalWeight, finalValue, age, gender, weight, nutrients[i]);
                                if(calc == 3) {
                                    alert("We are all good!");
                                    yay = false;
                                }
							} else if(countUp == 3) {
                                predetermined(finalAge, finalGender, finalWeight, finalValue, age, gender, weight, nutrients[i]);
                                if(calc == 4) {
                                    alert("We are all good!");
                                    yay = false;
                                }
							}
                        }
                        alert(calc);
                    }
                })
            }

            function predetermined(finalAge, finalGender, finalWeight, finalValue, age, gender, weight, nutrients) {
                if(finalValue != "") {
                    systemValue(finalValue, nutrients);
                }

            }
			function systemValue(compute, initital) {
                var startVal = "", endVal = "", cat = "";
                for(let k=0; k<compute.length; k++) {
                    if(compute[k] == "=" || k+1 == compute.length) {
                        if(k+1 == compute.length) {
                            cat += compute[k];
                            endVal = parseInt(cat, 10)
                        } else {
                            startVal = parseInt(cat, 10)
                        }
                        cat = "";
                    } else {
                        cat += compute[k];
                    }
                }
                if(initital <= endVal & initital >= startVal) {
                    calc++;
                }
			}
        </script>
    </body>
    </html>
